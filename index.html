<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pixel Pets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body {
  margin: 0;
  background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
  color: #f1f1f1;
  background-attachment: fixed;
  background-size: cover;
}

  </style>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const PET_SPECIES = {
     Dog: ['Monsters/003.png'],
     Cat: ['Monsters/002.png'],
     Bird: ['Monsters/001.png'],
     Rat: ['Monsters/004.png'],
     Corn: ['Monsters/005.png'],
     Bug: ['Monsters/006.png'],
     Lizard: ['Monsters/007.png'],
    };

    const hungerDecayRate = 1;

    function TamagotchiApp() {
      const [graveyard, setGraveyard] = React.useState([]);
      const [pubkey, setPubkey] = React.useState(null);
      const [profile, setProfile] = React.useState({ name: '', npub: '', picture: '' });
      const [pets, setPets] = React.useState([]);
      const [activePetIndex, setActivePetIndex] = React.useState(0);
      const [activeNav, setActiveNav] = React.useState('Home');
      const [showPetCreation, setShowPetCreation] = React.useState(false);
      const [showSettings, setShowSettings] = React.useState(false);
      const [showInventory, setShowInventory] = React.useState(false);
      const [sidebarCollapsed, setSidebarCollapsed] = React.useState(false);
      const [torontoTime, setTorontoTime] = React.useState('');

      // Update pets from storage
      React.useEffect(() => {
        if (pubkey) {
          const data = localStorage.getItem(`pets:${pubkey}`);
          if (data) setPets(JSON.parse(data));
        }
      }, [pubkey]);
      React.useEffect(() => {
        if (pubkey) localStorage.setItem(`pets:${pubkey}`, JSON.stringify(pets));
      }, [pets, pubkey]);


      const testLogin = () => {
        setPubkey('test_pubkey_0000');
        setProfile({
          name: 'Test User',
          npub: 'npub1test1234...',
          picture: 'https://api.dicebear.com/7.x/pixel-art/svg?seed=testprofile'
        });
      };
      const logout = () => {
        setPubkey(null);
        setProfile({ name: '', npub: '', picture: '' });
        setPets([]);
        setActivePetIndex(0);
      };
      
      
const createPet = (name, species, gender) => {
  // Separate dead pets and alive pets
  const deadPets = pets.filter(p => p.dead);
  const alivePets = pets.filter(p => !p.dead);

  // Move dead pets into graveyard (keep existing + new dead ones)
  if (deadPets.length > 0) {
    setGraveyard(prev => [...prev, ...deadPets.map(p => ({
      ...p,
      diedAt: Date.now()
    }))]);
  }

  // Create new pet
  const newPet = {
    name,
    species,
    gender,
    createdAt: Date.now(),
    lastUpdated: Date.now(),
    hunger: 100,
    health: 100,
    stage: 1,
    dead: false
  };

  setPets([...alivePets, newPet]);
  setActivePetIndex(0);
  setShowPetCreation(false);
};





      const feedPet = (index) => {
        setPets(prev => {
          const petsCopy = [...prev];
          const pet = { ...petsCopy[index] };
          if (!pet.dead) {
            pet.hunger = Math.min(100, pet.hunger + 20);
            pet.health = Math.min(100, pet.health + 5);
            pet.lastUpdated = Date.now();
          }
          petsCopy[index] = pet;
          return petsCopy;
        });
      };

// Add function inside TamagotchiApp
const euthanizePet = (index) => {
  setPets(prev => {
    const petsCopy = [...prev];
    const pet = { ...petsCopy[index] };
    if (!pet.dead) {
      pet.health = 0;
      pet.dead = true;
      pet.lastUpdated = Date.now();
    }
    petsCopy[index] = pet;
    return petsCopy;
  });
};




      const updatePetStatus = pet => {
        const hoursPassed = (Date.now() - pet.lastUpdated) / 3600000;
        pet.hunger = Math.max(0, pet.hunger - hoursPassed * hungerDecayRate);
        pet.lastUpdated = Date.now();
        if (pet.hunger <= 0) pet.dead = true;
        const ageDays = (Date.now() - pet.createdAt) / (1000 * 60 * 60 * 24);
        pet.stage = Math.min(5, Math.floor(ageDays / 2) + 1);
        return pet;
      };
      const activePet = pets[activePetIndex] ? updatePetStatus({ ...pets[activePetIndex] }) : null;
// SideBar Color
      const Sidebar = () => (
 <div style={{
  width: sidebarCollapsed ? '50px' : '250px',
  background: '#1f1f1f',
  color: 'white',
  display: 'flex',
  flexDirection: 'column',
  padding: '10px',
        // fills window height
  transition: 'width 0.3s ease-in-out',
  position: 'relative'
}}>


{!sidebarCollapsed && (
  <div style={{ textAlign: 'center', marginBottom: '20px' }}>
    <img 
      src="Assets/logo.png" 
      alt="Pets Transmitted by Relays" 
      style={{ width: '100%', maxWidth: '200px', imageRendering: 'pixelated' }}
    />
  </div>
)}



          {activePet && !sidebarCollapsed && (
        <button 
  type="button"
  onClick={() => { 
    setActiveNav('Home'); 
    setShowInventory(false); 
    setShowPetCreation(false); 
    setShowSettings(false); 
  }}
  style={{
    display: 'flex',
    alignItems: 'center',
    background: '#2a2a2a',
    padding: '5px',
    borderRadius: '12px',
    marginBottom: '20px',
    opacity: sidebarCollapsed ? 0 : 1,
    transition: 'opacity 0.5s',
    border: 'none',
    width: '100%',
    textAlign: 'left',
    color: 'white',
    cursor: 'pointer'
  }}
>
  <img src={PET_SPECIES[activePet.species][activePet.stage - 1]} alt={activePet.species}
    style={{ width: '60px', height: '60px', imageRendering: 'pixelated', marginRight: '10px' }} />
  <div style={{ display: 'flex', flexDirection: 'column' }}>
    <span style={{ fontWeight: 'bold' }}>{activePet.name}</span>
    <span>Health: {Math.round(activePet.health)}</span>
    <span>Hunger: {Math.round(activePet.hunger)}</span>
  </div>
</button>

          )}
       {profile.name && !sidebarCollapsed && (
  <button
    type="button"
    onClick={() => { 
      setActiveNav('Profile'); 
      setShowInventory(false); 
      setShowPetCreation(false); 
      setShowSettings(false); 
    }}
    style={{
      display: 'flex',
      alignItems: 'center',
      marginBottom: '20px',
      background: '#2a2a2a',
      padding: '5px',
      borderRadius: '12px',
      border: 'none',
      width: '100%',
      textAlign: 'left',
      color: 'white',
      cursor: 'pointer'
    }}
  >
    <img src={profile.picture} alt="profile"
      style={{ width: '60px', height: '60px', imageRendering: 'pixelated', marginRight: '10px' }} />
    <div style={{ display: 'flex', flexDirection: 'column', justifyContent: 'center' }}>
      <span>{profile.name}</span>
      <small>{profile.npub}</small>
    </div>
  </button>
)}


          <nav style={{ flexGrow: 1 }}>
           {['Games', 'Social', 'Friends'].map(nav => (
              <button type="button" key={nav} onClick={() => { setActiveNav(nav); setShowInventory(false); setShowPetCreation(false); setShowSettings(false); }}
                style={{
                  width: '100%', margin: '5px 0',
                  background: activeNav === nav ? '#444' : '#2a2a2a',
                  border: 'none', color: 'white', padding: '8px'
                }}>
                {nav}
              </button>
            ))}
            <button type="button" onClick={() => { setShowInventory(true); setShowPetCreation(false); setShowSettings(false); }}
              style={{ width: '100%', margin: '5px 0', background: '#2a2a2a', border: 'none', color: 'white', padding: '8px' }}>
              Inventory
            </button>
          </nav>

<div style={{ marginTop: 'auto' }}>
  {(!activePet || activePet.dead) && (
    <button type="button" onClick={() => setShowPetCreation(true)}
      style={{ width: '100%', margin: '5px 0', background: '#f59e0b', border: 'none', color: 'white', padding: '8px' }}>
      Create Pet
    </button>
  )}

  <button 
  type="button" 
  onClick={() => { 
    setShowInventory(false); 
    setShowPetCreation(false); 
    setShowSettings(false); 
    setActiveNav('Graveyard'); 
  }}
  style={{ 
    width: '100%', 
    margin: '5px 0', 
    background: '#6b7280', 
    border: 'none', 
    color: 'white', 
    padding: '8px' 
  }}
>
  Graveyard
</button>

  <button type="button" onClick={() => setShowSettings(true)}
    style={{ width: '100%', margin: '5px 0', background: '#6b21a8', border: 'none', color: 'white', padding: '8px' }}>
    Settings
  </button>
  <button type="button" onClick={logout}
    style={{ width: '100%', margin: '5px 0', background: '#ef4444', border: 'none', color: 'white', padding: '8px' }}>
    Logout
  </button>
</div>


<button type="button" aria-label="Collapse sidebar"
  onClick={() => setSidebarCollapsed(!sidebarCollapsed)}
  style={{
    position: 'absolute',
    right: sidebarCollapsed ? '-25px' : '-30px',
    top: '50%',
    transform: 'translateY(-50%)',
    background: 'rgba(50, 50, 50, 0.8)', // dark semi-transparent grey
    color: 'white',
    border: '2px solid rgba(255,255,255,0.2)', // optional subtle border
    borderRadius: '6px', // small rounding for a square-like shape
    width: '30px',
    height: '30px',
    cursor: 'pointer',
    zIndex: 10,
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'center',
    fontWeight: 'bold',
    fontSize: '16px'
  }}>
  ⮜
</button>

        </div>
      );

const PetCreationForm = ({ onCreate }) => {
  const [name, setName] = React.useState('');
  const [species, setSpecies] = React.useState('Dog');
  const [gender, setGender] = React.useState('Male');

  return (
    <div style={{ textAlign: 'center', marginTop: '20px', transition: 'opacity 0.5s' }}>
      <h2>Create New Pet</h2>
      <input 
        value={name} 
        onChange={e => setName(e.target.value)} 
        placeholder="Name"
        style={{ width: '200px', marginBottom: '10px' }} 
      />
      <br />

      <select 
        value={species} 
        onChange={e => setSpecies(e.target.value)}
        style={{ width: '200px', marginBottom: '10px' }}
      >
        {Object.keys(PET_SPECIES).map(s => <option key={s}>{s}</option>)}
      </select>

      {/* NEW: live image preview */}
      <br />
      <img 
        src={PET_SPECIES[species][0]} 
        alt={species} 
        style={{ width: '100px', imageRendering: 'pixelated', marginBottom: '10px' }} 
      />
      <br />

      <select 
        value={gender} 
        onChange={e => setGender(e.target.value)}
        style={{ width: '200px', marginBottom: '10px' }}
      >
        <option>Male</option>
        <option>Female</option>
      </select>
      <br />

      <button 
        type="button" 
        onClick={() => onCreate(name, species, gender)}
        style={{ background: '#3b82f6', color: 'white', padding: '5px', width: '200px' }}
      >
        Create Pet
      </button>
    </div>
  );
};


const [showGames, setShowGames] = React.useState(false);
const [showSocial, setShowSocial] = React.useState(false);
const [showProfile, setShowProfile] = React.useState(false);
const [showFriends, setShowFriends] = React.useState(false);

React.useEffect(() => {
  setShowGames(activeNav === 'Games');
  setShowSocial(activeNav === 'Social');
  setShowProfile(activeNav === 'Profile');
  setShowFriends(activeNav === 'Friends');
}, [activeNav]);

const MainContent = () => {
  if (showPetCreation) return <PetCreationForm onCreate={createPet} />;
  if (showSettings) return <div><h2>Settings - Coming Soon!</h2></div>;
  if (showInventory) return <div><h2>Inventory - Coming Soon!</h2></div>;

if (activeNav === 'Graveyard') {
  return (
    <div>
      <h2>Pet Graveyard</h2>
      {graveyard.length === 0 ? (
        <p>No pets have died yet.</p>
      ) : (
        <div style={{
          display: 'grid',
          gridTemplateColumns: 'repeat(3, 1fr)',
          gap: '20px',
          maxHeight: '70vh',
          overflowY: 'auto',
          padding: '10px'
        }}>
          {graveyard.map((pet, i) => {
            const lifespanMs = (pet.diedAt - pet.createdAt);
            const days = Math.floor(lifespanMs / (1000 * 60 * 60 * 24));
            const hours = Math.floor((lifespanMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((lifespanMs % (1000 * 60 * 60)) / (1000 * 60));

            return (
              <div key={i} style={{
                background: 'rgba(55, 55, 55, 0.8)',
                borderRadius: '12px',
                padding: '15px',
                textAlign: 'center',
                boxShadow: '0 0 10px rgba(100, 100, 100, 0.5)'
              }}>
                <img 
                  src={PET_SPECIES[pet.species][Math.max(0, pet.stage - 1)]} 
                  alt={pet.species} 
                  style={{ width: '100px', imageRendering: 'pixelated', marginBottom: '10px' }}
                />
                <h3>R.I.P.</h3>
                <h3>{pet.name}</h3>
                <p>Species: {pet.species}</p>
                <p>Lifespan: {days}d {hours}h {minutes}m</p>
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}



  return (

    <div style={{ height: '100%', width: '100%' }}>
      <div style={{ display: showGames ? 'block' : 'none', width: '100%', height: '100%' }}>
  <iframe src="games.html" title="Games"
    style={{ border: "none", width: "100%", height: "100%", display: "block" }} />
</div>

<div style={{ display: showSocial ? 'block' : 'none', width: '100%', height: '100%' }}>
  <iframe src="social.html" title="Social"
    style={{ border: "none", width: "100%", height: "100%", display: "block" }} />
</div>

<div style={{ display: showFriends ? 'block' : 'none', width: '100%', height: '100%' }}>
  <iframe src="friends.html" title="Friends"
    style={{ border: "none", width: "100%", height: "100%", display: "block" }} />
</div>

<div style={{ display: showProfile ? 'block' : 'none', width: '100%', height: '100%' }}>
  <iframe src="profile.html" title="Profile"
    style={{ border: "none", width: "100%", height: "100%", display: "block" }} />
</div>


{activeNav === "Home" && activePet && (
  <div 
    style={{
      maxWidth: "600px",
      margin: "40px auto",
      padding: "30px",
      border: "3px solid #9333ea", // main outer border
      borderRadius: "16px",
      background: "#1f1f1f",
      textAlign: "center",
      display: "flex",
      flexDirection: "column",
      gap: "25px",
    }}
  >
    {/* Name box */}
    <div style={{
      borderRadius: "10px",
      padding: "15px",
      background: "#2a2a2a",
      boxShadow: "2px 2px 10px rgba(0,0,0,0.7)",
    }}>
      <h2 style={{ color: "#c084fc", margin: "0", fontSize: "2em" }}>{activePet.name}</h2>
    </div>

    {/* Pet image */}
    <div>
      <img 
        src={PET_SPECIES[activePet.species][activePet.stage - 1]} 
        alt={activePet.species}
        style={{ width: '200px', imageRendering: 'pixelated', borderRadius: "10px" }} 
      />
    </div>

    {/* Stats panel */}
    <div style={{
      borderRadius: "16px",
      background: "#1a1a1a",
      padding: "20px",
      display: "grid",
      gridTemplateColumns: "1fr 1fr",
      gap: "15px",
    }}>
      {/* Individual stats */}
      {[
        { label: "Happiness", value: "???" },
        { label: "Species", value: activePet.species },
        { label: "Gender", value: activePet.gender },
        { label: "Age", value: `${Math.floor((Date.now() - activePet.createdAt) / (1000*60*60*24))} days` },
        { label: "Health", value: Math.round(activePet.health) },
        { label: "Hunger", value: Math.round(activePet.hunger) },
        { label: "Strength", value: "???" },
        { label: "Endurance", value: "???" },
        { label: "Agility", value: "???" },
        { label: "Luck", value: "???" },
      ].map((stat, idx) => (
        <div key={idx} style={{
          borderRadius: "8px",
          padding: "12px",
          background: "#2a2a2a",
          boxShadow: "2px 2px 12px rgba(0,0,0,0.6)",
          textAlign: "center",
          fontSize: "1em",
        }}>
          <strong style={{ color: "#c084fc" }}>{stat.label}:</strong> <span>{stat.value}</span>
        </div>
      ))}
    </div>

    {/* Action buttons */}
    <div style={{ display: "flex", justifyContent: "center", gap: "20px" }}>
      {activePet.dead ? (
        <p style={{ color: '#ef4444', fontWeight: 'bold', fontSize: "1.2em" }}>This pet has passed away.</p>
      ) : (
        <>
          <button
            type="button"
            onClick={() => feedPet(activePetIndex)}
            style={{
              background: "#6b21a8",
              color: "#fff",
              padding: "12px 20px",
              border: "none",
              borderRadius: "10px",
              cursor: "pointer",
              fontWeight: "bold",
              fontSize: "1em",
              boxShadow: "2px 2px 8px rgba(0,0,0,0.7)"
            }}
          >
            Feed
          </button>

          <button
            type="button"
            onClick={() => euthanizePet(activePetIndex)}
            style={{
              background: "#ef4444",
              color: "#fff",
              padding: "12px 20px",
              border: "none",
              borderRadius: "10px",
              cursor: "pointer",
              fontWeight: "bold",
              fontSize: "1em",
              boxShadow: "2px 2px 8px rgba(0,0,0,0.7)"
            }}
          >
            Euthanize
          </button>
        </>
      )}
    </div>
  </div>
)}







    </div>
  );
};
return (
  <div style={{
    display: 'flex',
    minHeight: '100vh'
  }}>
    {!pubkey ? (
      <div style={{ margin: 'auto', textAlign: 'center' }}>
        <h1>Pixel Pets</h1>
        <button type="button" onClick={testLogin}
          style={{ margin: '10px', background: '#10b981', color: 'white', padding: '10px' }}>
          Test Login
        </button>
      </div>
    ) : (
      <>
        <Sidebar />
        <div style={{ flexGrow: 1, height: '100vh', overflow: 'hidden' }}>
          <MainContent />
        </div>
      </>
    )}
  </div>
);


    }

    ReactDOM.createRoot(document.getElementById('root')).render(<TamagotchiApp />);
  </script>
</body>
</html>

